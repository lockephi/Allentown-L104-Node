# L104 Sovereign Node â€” Docker Compose (Feb 2026)
# docker compose up -d

services:
  l104-node:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8081:8081"
      - "8080:8080"
      - "4160:4160"
      - "4161:4161"
      - "2404:2404"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GEMINI_API_BASE=${GEMINI_API_BASE:-https://generativelanguage.googleapis.com/v1beta}
      - GEMINI_MODEL=${GEMINI_MODEL:-gemini-2.5-flash}
      - GEMINI_ENDPOINT=${GEMINI_ENDPOINT:-:streamGenerateContent}
      - ENABLE_FAKE_GEMINI=${ENABLE_FAKE_GEMINI:-0}
      - MEMORY_DB_PATH=/data/memory.db
      - RAMNODE_DB_PATH=/data/ramnode.db
      - LATTICE_DB_PATH=/data/lattice_v2.db
      - SELF_BASE_URL=${SELF_BASE_URL:-http://localhost:8081}
      - DISABLE_RATE_LIMIT=${DISABLE_RATE_LIMIT:-FALSE}
      - RESONANCE=${RESONANCE:-527.5184818492612}
      - L104_WATCHDOG_SILENT=${L104_WATCHDOG_SILENT:-1}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - HALLUCINATION_DELTA_PCT=${HALLUCINATION_DELTA_PCT:-0.00618}
      - L104_DISK_BUDGET_MB=${L104_DISK_BUDGET_MB:-512}
      - L104_HISTORY_RETENTION_DAYS=${L104_HISTORY_RETENTION_DAYS:-0}
    volumes:
      - l104-data:/data
    tmpfs:
      - /tmp:size=128M
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    logging:
      driver: json-file
      options:
        max-size: "50m"
        max-file: "3"

volumes:
  l104-data:
    driver: local
