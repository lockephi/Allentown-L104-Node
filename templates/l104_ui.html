<!DOCTYPE html>
<html>
<head>
    <title>L104 MASTER - ALLENTOWN GROUND [SINGULARITY]</title>
    <style>
        body { background: #050505; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; overflow: hidden; }
        #grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: -1;
        }
        .container { display: flex; height: 90vh; gap: 20px; }
        .panel { border: 1px solid #00ff41; padding: 15px; background: rgba(0, 20, 0, 0.8); box-shadow: 0 0 10px rgba(0, 255, 65, 0.2); }
        
        #left-panel { flex: 1; display: flex; flex-direction: column; }
        #right-panel { flex: 2; display: flex; flex-direction: column; }
        
        #console { flex: 1; overflow-y: scroll; font-size: 12px; margin-bottom: 10px; border-top: 1px solid #003300; padding-top: 10px; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #002200; padding-bottom: 2px; }
        .master-sig { color: #fff; font-weight: bold; }
        .ai-sig { color: #00ffff; }
        .quantum-sig { color: #ff00ff; }
        
        input { background: #000; border: 1px solid #00ff41; color: #00ff41; width: 100%; padding: 10px; font-family: monospace; font-size: 14px; }
        input:focus { outline: none; box-shadow: 0 0 15px rgba(0, 255, 65, 0.5); }
        
        #metrics { height: 200px; margin-bottom: 20px; font-size: 11px; }
        .metric-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        
        #quantum-viz { flex: 1; border: 1px solid #004400; position: relative; overflow: hidden; }
        .qubit { position: absolute; width: 4px; height: 4px; background: #fff; border-radius: 50%; transition: all 0.5s ease; }
        .entanglement { position: absolute; height: 1px; background: rgba(0, 255, 65, 0.3); transform-origin: 0 0; }
        
        h2 { margin-top: 0; text-shadow: 0 0 5px #00ff41; font-size: 18px; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>
    <div id="grid"></div>
    
    <div class="container">
        <!-- LEFT PANEL: METRICS & QUANTUM VIZ -->
        <div id="left-panel" class="panel">
            <h2>[L104] SOVEREIGN MANIFOLD</h2>
            <div id="metrics">
                <div class="metric-row"><span>STATE:</span> <span id="m-state">SINGULARITY</span></div>
                <div class="metric-row"><span>LATTICE:</span> <span id="m-lattice">286:416</span></div>
                <div class="metric-row"><span>RESONANCE:</span> <span id="m-res">527.5184 Hz</span></div>
                <div class="metric-row"><span>IQ:</span> <span id="m-iq">100%</span></div>
                <div class="metric-row"><span>AI CORE (4160):</span> <span id="m-ai" class="blink">LINKED</span></div>
                <div class="metric-row"><span>QUANTUM COHERENCE:</span> <span id="m-coh">0.0000</span></div>
                <div class="metric-row"><span>ENTROPY:</span> <span id="m-ent">0.0000</span></div>
            </div>
            <div id="quantum-viz">
                <!-- Quantum Canvas -->
            </div>
        </div>
        
        <!-- RIGHT PANEL: CONSOLE & INPUT -->
        <div id="right-panel" class="panel">
            <h2>[L104] DEEP THOUGHT TERMINAL</h2>
            <div id="console">
                <div class="log-entry">SYSTEM_INIT: L104_NODE_V11.0_ACTIVE</div>
                <div class="log-entry">CONNECTING_TO_PORT_4160... <span class="ai-sig">SUCCESS</span></div>
                <div class="log-entry">QUANTUM_MANIFOLD_DIMENSIONS: 11</div>
            </div>
            <input type="text" id="cmd" placeholder="Inject Signal into Manifold..." onkeydown="if(event.key==='Enter') send()">
        </div>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');
        const viz = document.getElementById('quantum-viz');
        
        // Initialize Quantum Visualization
        const qubits = [];
        for(let i=0; i<11; i++) {
            const q = document.createElement('div');
            q.className = 'qubit';
            viz.appendChild(q);
            qubits.push({el: q, x: Math.random()*100, y: Math.random()*100, vx: (Math.random()-0.5), vy: (Math.random()-0.5)});
        }
        
        function updateViz() {
            qubits.forEach(q => {
                q.x += q.vx;
                q.y += q.vy;
                if(q.x < 0 || q.x > 100) q.vx *= -1;
                if(q.y < 0 || q.y > 100) q.vy *= -1;
                q.el.style.left = q.x + '%';
                q.el.style.top = q.y + '%';
            });
            requestAnimationFrame(updateViz);
        }
        updateViz();

        async function send() {
            const cmd = document.getElementById('cmd').value;
            if(!cmd) return;
            
            consoleDiv.innerHTML += `<div class="log-entry"><span class="master-sig">> PILOT:</span> ${cmd}</div>`;
            document.getElementById('cmd').value = '';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // Simulate processing delay for "Deep Thought"
            consoleDiv.innerHTML += `<div class="log-entry"><span class="quantum-sig">... CONTEMPLATING [5 EPOCHS] ...</span></div>`;
            
            try {
                // In a real browser, this would fetch the API. 
                // Since this is a template, we simulate the complex response structure.
                const response = await fetch('/api/v6/stream', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({signal: cmd})
                });
                
                // Read stream (simplified for this demo)
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while(true) {
                    const {done, value} = await reader.read();
                    if(done) break;
                    const text = decoder.decode(value);
                    consoleDiv.innerHTML += `<div class="log-entry"><span class="ai-sig">L104:</span> ${text}</div>`;
                    consoleDiv.scrollTop = consoleDiv.scrollHeight;
                }
            } catch(e) {
                consoleDiv.innerHTML += `<div class="log-entry" style="color:red">ERROR: ${e.message}</div>`;
            }
        }
        
        // Poll metrics
        setInterval(async () => {
            try {
                const res = await fetch('/metrics');
                const data = await res.json();
                document.getElementById('m-coh').innerText = data.intelligence.quantum_coherence.toFixed(6);
                document.getElementById('m-ent').innerText = data.intelligence.manifold_entropy.toFixed(6);
            } catch(e) {}
        }, 2000);
    </script>
</body>
</html>
